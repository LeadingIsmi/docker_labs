# Лабораторная работа 3: Сборка с использованием Multistage для минимизации размера образа

## Шаги для выполнения лабораторной работы

~~~sh
# Создаём образ с multistage сборкой для кирпичного языка
docker build . -f Dockerfile-multistage -t brick_language_multistage

# Запускаем контейнер с минимизированным образом
docker run --rm brick_language_multistage

# Для тестирования добавляем дополнительные параметры
docker run --rm brick_language_multistage плюшки

# Удаляем образ
docker rmi brick_language_multistage
~~~

Пример вывода:
~~~
brick_language_multistage         latest    4c1debed9477   4 minutes ago   16.5MB
full_brick_language_build_image   latest    2375e2d4fe2a   5 minutes ago   877MB
~~~

### Разница в размере образов:
- **full_brick_language_build_image** — **877MB**
- **brick_language_multistage** — **16.5MB**
- **Снижение размера образа почти в 53 раза!**

---

## Объяснение различий между традиционным и multistage подходом

В отличие от лабораторной работы 1, где использовался стандартный метод сборки (весь процесс и зависимости помещаются в финальный образ), в этой работе применяется **multistage сборка**, которая позволяет существенно уменьшить размер финального контейнера:

- **Этап сборки:**
  - Используется образ с полной средой для сборки, который включает все необходимые инструменты для компиляции и сборки.
  - В этом шаге происходит компиляция исходного кода и создание исполнимого файла.

- **Этап выполнения:**
  - Здесь используется минимизированный контейнер с только необходимыми зависимостями для выполнения программы. В данном случае для сборки используется образ `scratch` или иной легковесный образ, содержащий только сам исполнимый файл.
  
### Почему multistage сборка выгодна?

- **Снижение размера образа:** Исключаются ненужные зависимости, инструменты разработки и временные файлы. Например, итоговый образ **brick_language_multistage** весит лишь **16.5MB**, в то время как традиционный образ, включающий все сборочные инструменты, занимает **877MB**.
  
- **Ускорение развертывания:** Легковесный контейнер, не содержащий лишних компонентов, загружается и разворачивается значительно быстрее, что важно для production-окружений.

- **Повышение безопасности:** За счет исключения инструментов сборки из финального контейнера, уменьшается количество потенциальных уязвимостей и атакующих поверхностей.

---

### Заключение

Использование **multistage сборки** значительно улучшает работу с контейнерами, минимизируя их размер без потери функциональности. Этот подход помогает создавать более быстрые, безопасные и легковесные образы, что особенно важно для продакшн-окружений и CI/CD процессов.